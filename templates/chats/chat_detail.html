{% load static %}

<!-- Prompt Messages Container -->
<div class="flex h-[80vh] w-full flex-col mx-2 " id="{{ chat_id }}">
    <!-- Prompt Messages -->
    <div id="chat-messages"
         class="flex-1 overflow-y-auto  rounded-xl bg-slate-200 p-4 text-sm leading-6 text-slate-900 dark:bg-slate-800 dark:text-slate-300 sm:text-base sm:leading-7">
        {% for message in messages %}
            {% if message.sender == 'user' %}
                <div class="message flex flex-row px-2 py-4 sm:px-4">
                    <img class="mr-2 flex h-8 w-8 rounded-full sm:mr-4" src="{% static user.profile.avatar %}" alt="{{ message.sender }} avatar">
                    <div class="flex max-w-3xl items-center">
                        <p>{{ message.content }}</p>
                    </div>
                </div>
            {% else %}
                <div class="message" x-data="{ messageContent: $el.dataset.content }" data-content="{{ message.content }}">
                    <div class="mb-2 flex w-full flex-row justify-end gap-x-2 text-slate-500">
                        <button class="hover:text-blue-600" @click="navigator.clipboard.writeText(messageContent)">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path>
                                <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="mb-4 flex rounded-xl bg-slate-50 px-2 py-6 dark:bg-slate-900 sm:px-4">
                        <img class="mr-2 flex h-8 w-8 rounded-full sm:mr-4" src="{% static 'images/bot.jpeg' %}">
                        <div class="flex max-w-3xl items-center rounded-xl">
                            <p x-text="messageContent"></p>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
        <!-- Infinite scroll trigger -->
        <div id="scroll-trigger"></div>
    </div>
    <!-- Prompt message input -->
    <form id="chat-form" class="mt-2">
        <label for="chat-input" class="sr-only">Enter your prompt</label>
        <div class="relative">
            <button type="button"
                    class="absolute inset-y-0 left-0 flex items-center pl-3 text-slate-500 hover:text-blue-500 dark:text-slate-400 dark:hover:text-blue-500">
                <!-- Voice input icon -->
            </button>
            <textarea id="chat-input"
                      class="block w-full resize-none rounded-xl border-none bg-slate-200 p-4 pl-10 pr-20 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-blue-500 sm:text-base"
                      placeholder="Enter your prompt" rows="1" required></textarea>
            <button type="submit"
                    class="absolute bottom-2 right-2.5 rounded-lg bg-blue-700 p-2 text-slate-200 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                <!-- Send message icon -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"/>
                </svg>
                <span class="sr-only">Send message</span>
            </button>
        </div>
    </form>
</div>
